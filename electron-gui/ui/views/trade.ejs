<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
    <title>{{= title }}</title>

	<link href="/css/bootstrap.min.css" rel="stylesheet" media="screen"/>
    <link href="/css/custom.css" rel="stylesheet"/>
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet"/>
    <link href="/css/context.bootstrap.css" rel="stylesheet"/>

</head>
<body>
    <section id="toolbars">
        <!-- Top menu toolbar -->
        <div class="navbar navbar-inverse navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <ul class="nav" id="menu">
                        <li><a class="brand">P.Eng</a></li>
                        <li class="active"><a href="/portfolio" id="portfolio">Portfolio Manager</a></li>
                    </ul>
                    <ul class="nav pull-right">
                        <li><a href="/help"><i class="icon-question-sign icon-white" ></i> Help</a></li>

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#user" id="username">
                                <i class="icon-user icon-white" ></i>
                                {{= username }}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                            <!-- dropdown menu links -->
                                <li><a href="/mailbox"><i class="icon-inbox"></i> Inbox</a></li>
                                <li class="divider"></li>
                                <li><a type="submit" href="/logout" id="logoutbtn"><i class="icon-off"></i>Log out</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Submenu toolbar -->
        <div class="navbar navbar-static-top" id="apptoolbar">
            <div class="navbar-inner">
                <ul class="nav" id="submenu">
                    <li><a href="#newportfolio" data-toggle="modal" id="home-new"><i class="icon-plus"></i>New</a></li>
                    <li><a href="#editportfolio" data-toggle="modal" id="portfolio-settings-btn"><i class="icon-edit"></i> Edit </a></li>
                    <li class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#user" id="A2">
                            <i class="icon-cog" ></i>Analysis                             
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                        <!-- dropdown menu links -->
                            <li><a href="#" id="riskanalysis-btn">Risk Analysis</a></li>
                            <li><a href="#" id="mvo-btn">Mean-variance Optimization</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <br />
    <!-- Main -->
    <section id="portfolioapp">
        <section id="modals">
            <!-- New Portfolio Modal -->
            <div id="newportfolio" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="newportfolio-modal" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="newportfolio-modal">Create new portfolio</h3>
                </div>
                <div class="modal-body">
                    <div>
                        <input autofocus="autofocus" type="text" placeholder="Portfolio Name" id="newportfolioname"/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="saveportfolio">Save</button>
                </div>
            </div>

            <!-- Delete Portfolio Modal -->
            <div id="delportfolio" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="portfolio-modal" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="H2">Delete Portfolio</h3>
                </div>
                <div class="modal-body">
                    <div>
                        <label>Are you sure want to delete the portfolio?</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="del-portf-btn">Delete</button>
                </div>
            </div>

            <!-- Edit Investment Modal -->
            <div id="edit-investment" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="investment-modal" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3 id="investment-modal">Update Investment</h3>
                </div>
                <div class="modal-body">
                    <div>
                        <table class="table table-hover table-condensed">
                            <thead class="tableheader">
                                <tr>
                                    <th>Short Name</th>
                                    <th>Total Exposure (R)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td id="inv-name" data-assetid=""></td>
                                    <td><input id="inv-exposure" class="input span2" type="number" step="10" value="0"/></td>
                                </tr>                          
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="upd-inv-btn">Update</button>
                </div>
            </div>

            <!-- Delete Investment Modal -->
            <div id="delete-investment" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="investment-modal" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h3 id="H1">Delete Investment</h3>
                </div>
                <div class="modal-body">
                    <div id="del-inv">
                        <label>Are you sure want to remove the investment from your portfolio?</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="del-inv-btn">Delete</button>
                </div>
            </div>
        </section>

        <div class="container-fluid">
            <div class="row-fluid">
                <!-- Left navigation panel -->
                <div class="span2 pull-left" id="portfoliolistbox">
                    <div class="well sidebar-nav">
                        <ul class="nav nav-list" id="portfoliolist">
                            <li class="nav-header large">Portfolios</li>
                        </ul>
                    </div>
                </div>

                <!-- Body -->
                <div class="span10" id="mainbody">
                    <div id="notice">
                    </div>
                    <div id="TabWrap">
                        <ul class="nav nav-tabs" id="TabHead">
                            <li class="active">
                                <a href="#portfolio-tab" data-toggle="tab" id="portfolio-tab-head">Portfolio Overview</a>
                            </li>
                            
                        </ul>
                        <div class="tab-content" id="TabBody">
                            <div class="tab-pane active" id="portfolio-tab">
                                <!-- Table data -->
                                <div class="accordion" id="table-accordion">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#table-accordion" href="#collapseTable">
                                                Portfolio Holdings
                                            </a>
                                        </div>
                                        <div id="collapseTable" class="accordion-body collapse in">
                                            <div class="accordion-inner">
                                                
                                                <div class="row-fluid">
                                                    <div id="search">
                                                        <input id="search-input" class="typeahead" disabled>
                                                        <button id="add-asset" class="btn" type="button" disabled>Add to portfolio</button>
                                                    </div>
                                                    <br />
                                                    <table class="table table-hover table-condensed">
                                                        <thead class="tableheader">
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Code</th>
                                                                <th>Sector</th>
                                                                <th>Exchange</th>
                                                                <th>Currency</th>
                                                                <th>Total Exposure (R)</th>
                                                                <th>% of Portfolio</th>
                                                                <th></th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tabledata">
                                                                
                                                        </tbody>
                                                        <tfoot id="tablefoot">

                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion" id="exposure-accordion">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#exposure-accordion" href="#collapseCharts">
                                                Portfolio Exposure
                                            </a>
                                        </div>
                                        <div id="collapseCharts" class="accordion-body collapse in">
                                            <div class="accordion-inner">
                                                <div class="row">
                                                    <div id="pie-chart" class="span5">

                                                    </div>
                                                    <div id="timseries-chart" class="span7">

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>   
                                
                                <div class="accordion" id="constraints-accordian">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#constraints-accordian" href="#collapseConstraints">
                                                Portfolio Constraints
                                            </a>
                                        </div>
                                        <div id="collapseConstraints" class="accordion-body collapse in">
                                            <div class="accordion-inner">
                                                <div class="row-fluid">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Equation</th>
                                                                <th>Relation</th>
                                                                <th>Min/Max Weight</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <input type="text" class="input-xxlarge"/>
                                                                </td>
                                                                <td>
                                                                    
                                                                    <select class="input-mini">
                                                                        <option><</option>
                                                                        <option>></option>
                                                                        <option>=</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <div class="input-append">
                                                                        <input type="number" max="100"/>
                                                                        <button class="btn btn-primary" type="button">ADD</button>
                                                                    </div>
                                                                    
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                                <div class="row-fluid">
                                                    <div>
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th>Contraints</th>
                                                                </tr>
                                                            </thead>

                                                            <tbody id="constraintdata">
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="accordion" id="performance-accordian">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#performance-accordian" href="#collapsePerformance">
                                                Portfolio Performance
                                            </a>
                                        </div>
                                        <div id="collapsePerformance" class="accordion-body collapse in">
                                            <div class="accordion-inner">
                                                <div class="row">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- hidden tab template -->

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- TEMPLATES -->
    <!-- Portfolio summary item template -->
    <script type="text/template" id="item-template">
        <a id="<%=_id %>" class="portfolio-item" href="javascript:;"> <%= name %></a>  
    </script>

    <!-- Table data template -->
    <script type="text/template" id="investmentdata-template">
        <td><a class="asset" href="#"> <%= asset.name %> </a></td>
        <td> <%= asset.ticker %> </td>
        <td> <%= asset.sector %></td>
        <td> <%= asset.exchange %></td>
        <td> <%= asset.currency %></td>
        <td> <%= exposure %></td>
        <td> <%= (weight*100).toFixed(2) %> </td>
        <td><a class="edit-btn" href="#edit-investment" data-toggle="modal"><i class="icon-edit"></i></a></td>
        <td><a class="delete-btn" href="#delete-investment" data-toggle="modal"><i class="icon-remove-sign"></i></a></td>
    </script>

    <script type="text/template" id="portfolio-tpl">
        <tr class="bold">
            <td> Total: </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td></td>
            <td> <%= exposure %></td>
            <td> 100 </td>
            <td></td>
            <td></td>
        </tr>
    </script>

    <!-- Constraints data template -->
    <script type="text/template" id="constraintsdata-tpl">
        <td><a class="asset" href="#"></a></td>
        <td> </td>
        <td> <%= relation %></td>
    </script>

    <!-- Portfolio Edit template -->
    <script type="text/template" id="portfolioEdit-tabHead-tpl">
        <li><a href="#<%=_id%>-edit-tabBody" data-toggle="tab" id="<%=_id%>-edit-tabHead"><%=name%> - Edit</a></li>
    </script>

    <script type="text/template" id="portfolioEdit-tpl">
        <div class="tab-pane" id="<%=_id%>-edit-tabBody">
            <div class="span4">
                <h4>Portfolio properties</h4>

                <!-- Text input-->
                <table>
                    <tbody>
                        <tr class="input-prepend">
                            <td><span class="add-on">Name</span></td>
                            <td><input  id="portfolio-name" type="text" value="<%= name %>"/></td>
                        </tr>
            
                        <tr class="input-prepend">
                            <td><span class="add-on">NAV</span></td>
                            <td><input  id="portfolio-nav" type="number" value="<%= NAV %>"/></td>
                        </tr>

                        <tr class="input-prepend">
                            <td><span class="add-on">Benchmark</span></td>
                            <td><input id="benchmark" class="typeahead"/></td>
                        </tr>
                        <tr class="text-center">
                            <td><button id="savePortfolioEdit-btn" name="save" class="btn btn-primary">Save</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="span8 pull-right">
                <div>
                    <div id="file_dropzone" class="well well-large"> 
                        Drag <strong>data</strong> (csv files only) here
                    </div>

                    <div id="readprogress" class="progress" hidden>
                        <div class="bar" style="width: 60%;"></div>
                    </div>
                    
                </div>
                <table class="table table-hover table-condensed table-bordered">
                    <thead id="filehead">

                    </thead>
                    <tbody id="filedata">

                    </tbody>
                </table>
            </div>

        </div>
    </script>

    <!-- Asset template -->
    <script type="text/template" id="asset-tabhead-tpl">
        <li><a href="#<%=ticker%>-tabBody" data-toggle="tab" id="<%=ticker%>-tabHead"><%=name%></a></li>
    </script>

    <script type="text/template" id="asset-view-tpl">
        <div class="tab-pane" id="<%=ticker%>-tabBody"> 
            <div class="span4">
                <table class="table table-condensed table-bordered">
                    <tbody>
                        <tr>
                            <td> <strong>Name: </strong></td>
                            <td> <%= name %> </td>
                        </tr>
                        <tr>
                            <td> <strong>Ticker: </strong> </td>
                            <td> <%= ticker %> </td>
                        </tr>
                        <tr>
                            <td> <strong>Exchange: </strong></td>
                            <td> <%= exchange %> </td>
                        </tr>
                        <tr>
                            <td> <strong>Asset Class: </strong></td>
                            <td> <%= assetclass.toUpperCase() %> </td>
                        </tr>
                        <tr>
                            <td> <strong>Sector: </strong></td>
                            <td> <%= sector %> </td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Return Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(metrics) { %> 
                            <% _.each(metrics, function(m) {  %> 
                                <% if (m.type==="return") { %>
                                <tr>
                                    <td> <%= m.name %>:</td>
                                    <td>
                                        <%= m.value %>
                                    </td>
                                </tr>  
                            <% }}) %>
                        <% } %>
                    <tbody>                 
                </table>

                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Risk Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(metrics) { %> 
                            <% _.each(metrics, function(m) {  %> 
                                <% if (m.type==="risk") { %>
                                <tr>
                                    <td> <%= m.name %>:</td>
                                    <td>
                                        <%= m.value %>
                                    </td>
                                </tr>  
                            <% }}) %>
                        <% } %>
                    <tbody>                 
                </table>
            </div>

            <div class="span8">
                <div id="<%=ticker%>-tsChart">

                </div>
            </div>
        </div>
    </script>

    <!-- Risk Analysis template -->
    <script type="text/template" id="risk-tabHead-tpl">
        <li><a href="#<%=_id%>-risk-tabBody" data-toggle="tab" id="<%=_id%>-risk-tabHead"><%=name%> - Risk Overview</a></li>
    </script>

    <script type="text/template" id="riskanalysis-view-tpl">
        <div class="tab-pane" id="<%=_id%>-risk-tabBody">        
            <div class="span4">
                <table class="table table-condensed table-bordered">
                    <tbody>
                        <tr>
                            <td> <strong><%= name %> </strong></td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Return Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(metrics) { %> 
                            <% _.each(metrics, function(m) {  %> 
                                <% if (m.type==="return") { %>
                                <tr>
                                    <td> <%= m.name %>:</td>
                                    <td>
                                        <%= m.value %>
                                    </td>
                                </tr>  
                            <% }}) %>
                        <% } %>
                    <tbody>                 
                </table>

                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>Risk Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(metrics) { %> 
                            <% _.each(metrics, function(m) {  %> 
                                <% if (m.type==="risk") { %>
                                <tr>
                                    <td> <%= m.name %>:</td>
                                    <td>
                                        <%= m.value %>
                                    </td>
                                </tr>  
                            <% }}) %>
                        <% } %>
                    <tbody>                 
                </table>
            </div>    
        </div>
    </script>

    <!-- MVO template -->
    <script type="text/template" id="mvo-tabHead-tpl">
        <li><a href="#<%=_id%>-mvo-tabBody" data-toggle="tab" id="<%=_id%>-mvo-tabHead"><%=name%> - MVO</a></li>
    </script>

    <script type="text/template" id="mvo-view-tpl">
        <div class="tab-pane" id="<%=_id%>-mvo-tabBody">        
            <div class="span4">
                <table class="table table-condensed table-bordered">
                    <tbody>
                        <tr>
                            <td> <strong><%= name %> </strong></td>
                            <td id="mvo-string"></td>
                        </tr>
                    </tbody>
                </table>
            </div>    
        </div>
    </script>

    <!-- libs -->
    <script src="./js/lib/d3.v3.min.js"></script>
    <script src="./js/lib/jquery-2.0.2.min.js"></script>
    <script src="./js/lib/bootstrap.min.js"></script>
    <script src="./js/lib/context.js"></script>
    <script src="./js/lib/underscore-min.js"></script>
    <script src="./js/lib/backbone-min.js"></script>
    <script src="./js/lib/backbone-relational.js"></script>
    <script src="./js/lib/socket.io.js"></script>

    <script src="./core/js/notification.js"></script>
    <script src="./core/js/charts/pieChart.js"></script>
    <script src="./core/js/charts/timeseriesChart.js"></script>

    <script src="./core/js/models/asset.js"></script>

    <!-- models -->
    <script src="./core/js/models/investment.js"></script>
    <script src="./core/js/models/constraint.js"></script>
    <script src="./core/js/models/portfolio.js"></script>

   
    <!-- routers -->
    <script src="./core/js/routers/router.js"></script>

    <!-- views -->
    <script src="./core/js/views/app.js"></script>
    <script src="./core/js/views/portfolioList.js"></script>
    <script src="./core/js/views/portfolioSummary.js"></script>
    <script src="./core/js/views/portfolio.js"></script>
    <script src="./core/js/views/portfolio_edit.js"></script>
    <script src="./core/js/views/investment.js"></script>
    <script src="./core/js/views/asset.js"></script>
    <script src="./core/js/views/asset/assetTabHead.js"></script>
    <script src="./core/js/views/riskAnalysis.js"></script>
    <script src="./core/js/views/mvOptimization.js"></script>
    
    <!-- main application -->
    <script src="./core/js/start/portfolio.js"></script>
</body>
</html>